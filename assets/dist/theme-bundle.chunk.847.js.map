{"version":3,"file":"theme-bundle.chunk.847.js","mappings":"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","sources":["webpack://bigcommerce-cornerstone/./assets/js/theme/search.js"],"sourcesContent":["import { hooks } from '@bigcommerce/stencil-utils';\nimport CatalogPage from './catalog';\nimport $ from 'jquery';\nimport FacetedSearch from './common/faceted-search';\nimport compareProducts from './global/compare-products';\nimport urlUtils from './common/url-utils';\nimport Url from 'url';\nimport collapsibleFactory from './common/collapsible';\nimport 'jstree';\nimport nod from './common/nod';\nimport Countdown from './autoimex/autoimex_countdown';\n\n\nexport default class Search extends CatalogPage {\n    formatCategoryTreeForJSTree(node) {\n        const nodeData = {\n            text: node.data,\n            id: node.metadata.id,\n            state: {\n                selected: node.selected,\n            },\n        };\n\n        if (node.state) {\n            nodeData.state.opened = node.state === 'open';\n            nodeData.children = true;\n        }\n\n        if (node.children) {\n            nodeData.children = [];\n            node.children.forEach((childNode) => {\n                nodeData.children.push(this.formatCategoryTreeForJSTree(childNode));\n            });\n        }\n\n        return nodeData;\n    }\n\n    showProducts() {\n        const url = urlUtils.replaceParams(window.location.href, {\n            section: 'product',\n        });\n\n        this.$productListingContainer.removeClass('u-hiddenVisually');\n        // this.$facetedSearchContainer.removeClass('u-hiddenVisually');\n        this.$contentResultsContainer.addClass('u-hiddenVisually');\n\n        $('[data-content-results-toggle]').parent().removeClass('is-active');\n        $('[data-content-results-toggle]').parent().addClass('navBar-action');\n\n        $('[data-product-results-toggle]').parent().removeClass('navBar-action');\n        $('[data-product-results-toggle]').parent().addClass('is-active');\n\n        urlUtils.goToUrl(url);\n    }\n\n    showContent() {\n        const url = urlUtils.replaceParams(window.location.href, {\n            section: 'content',\n        });\n\n        this.$contentResultsContainer.removeClass('u-hiddenVisually');\n        this.$productListingContainer.addClass('u-hiddenVisually');\n        // this.$facetedSearchContainer.addClass('u-hiddenVisually');\n\n        $('[data-product-results-toggle]').parent().removeClass('is-active');\n        $('[data-product-results-toggle]').parent().addClass('navBar-action');\n\n        $('[data-content-results-toggle]').parent().removeClass('navBar-action');\n        $('[data-content-results-toggle]').parent().addClass('is-active');\n\n        urlUtils.goToUrl(url);\n    }\n\n    onReady() {\n        compareProducts(this.context.urls);\n        \n        const $searchForm = $('[data-advanced-search-form]');\n        const $categoryTreeContainer = $searchForm.find('[data-search-category-tree]');\n        const url = Url.parse(window.location.href, true);\n        const treeData = [];\n        this.$productListingContainer = $('#product-listing-container');\n        this.$facetedSearchContainer = $('#faceted-search-container');\n        this.$contentResultsContainer = $('#search-results-content');\n\n        // Init faceted search\n        if ($('#facetedSearch').length > 0) {\n            this.initFacetedSearch();\n        } else {\n            this.onSortBySubmit = this.onSortBySubmit.bind(this);\n            hooks.on('sortBy-submitted', this.onSortBySubmit);\n        }\n        this.sidebar_mobile();\n        this.product_sidebar(); \n        this.carouselLeftSidebar();\n\n        //Countdown time product detail\n        var product_id = $('[data-product-id]').val();\n        Countdown(product_id);\n\n        // Init collapsibles\n        collapsibleFactory();\n\n        $('[data-product-results-toggle]').on('click', event => {\n            event.preventDefault();\n            this.showProducts();\n        });\n\n        $('[data-content-results-toggle]').on('click', event => {\n            event.preventDefault();\n            this.showContent();\n        });\n\n        if (this.$productListingContainer.find('li.product').length === 0 || url.query.section === 'content') {\n            this.showContent();\n        } else {\n            this.showProducts();\n        }\n\n        const validator = this.initValidation($searchForm)\n            .bindValidation($searchForm.find('#search_query_adv'));\n\n        this.context.categoryTree.forEach((node) => {\n            treeData.push(this.formatCategoryTreeForJSTree(node));\n        });\n\n        this.categoryTreeData = treeData;\n        this.createCategoryTree($categoryTreeContainer);\n\n        $searchForm.on('submit', event => {\n            const selectedCategoryIds = $categoryTreeContainer.jstree().get_selected();\n\n            if (!validator.check()) {\n                return event.preventDefault();\n            }\n\n            $searchForm.find('input[name=\"category\\[\\]\"]').remove();\n\n            for (const categoryId of selectedCategoryIds) {\n                const input = $('<input>', {\n                    type: 'hidden',\n                    name: 'category[]',\n                    value: categoryId,\n                });\n\n                $searchForm.append(input);\n            }\n        });\n    }\n\n    loadTreeNodes(node, cb) {\n        $.ajax({\n            url: '/remote/v1/category-tree',\n            data: {\n                selectedCategoryId: node.id,\n                prefix: 'category',\n            },\n        }).done(data => {\n            const formattedResults = [];\n\n            data.forEach((dataNode) => {\n                formattedResults.push(this.formatCategoryTreeForJSTree(dataNode));\n            });\n\n            cb(formattedResults);\n        });\n    }\n\n    createCategoryTree($container) {\n        const treeOptions = {\n            core: {\n                data: (node, cb) => {\n                    // Root node\n                    if (node.id === '#') {\n                        cb(this.categoryTreeData);\n                    } else {\n                        // Lazy loaded children\n                        this.loadTreeNodes(node, cb);\n                    }\n                },\n                themes: {\n                    icons: true,\n                },\n            },\n            checkbox: {\n                three_state: false,\n            },\n            plugins: [\n                'checkbox',\n            ],\n        };\n\n        $container.jstree(treeOptions);\n    }\n\n    initFacetedSearch() {\n        const $productListingContainer = $('#product-listing-container');\n        const $facetedSearchContainer = $('#faceted-search-container');\n        const $searchHeading = $('#search-results-heading');\n        const $searchCount = $('#search-results-product-count');\n        const productsPerPage = this.context.searchProductsPerPage;\n        const requestOptions = {\n            template: {\n                productListing: 'search/product-listing',\n                sidebar: 'search/sidebar',\n                heading: 'search/heading',\n                productCount: 'search/product-count',\n            },\n            config: {\n                product_results: {\n                    limit: productsPerPage,\n                },\n            },\n            showMore: 'search/show-more',\n        };\n\n        this.facetedSearch = new FacetedSearch(requestOptions, (content) => {\n            $productListingContainer.html(content.productListing);\n            $facetedSearchContainer.html(content.sidebar);\n            $searchHeading.html(content.heading);\n            $searchCount.html(content.productCount);\n\n            $('html, body').animate({\n                scrollTop: 0,\n            }, 100);\n        });\n    }\n\n    initValidation($form) {\n        this.$form = $form;\n        this.validator = nod({\n            submit: $form,\n        });\n\n        return this;\n    }\n\n    bindValidation($element) {\n        if (this.validator) {\n            this.validator.add({\n                selector: $element,\n                validate: 'presence',\n                errorMessage: $element.data('errorMessage'),\n            });\n        }\n\n        return this;\n    }\n\n    check() {\n        if (this.validator) {\n            this.validator.performCheck();\n            return this.validator.areAll('valid');\n        }\n\n        return false;\n    }\n\n    sidebar_mobile() {\n        if ($('.page-sidebar').length > 0) {\n            $('.page-sidebar').clone().appendTo($(\"#sidebar-mobile .autoimex_MobileContent\"));\n\n            $(document).on('click','.autoimex_sidebar-mobile', (event) => {\n                $('body').addClass('autoimex_open-Sidebar');\n                \n            });\n\n            $('#sidebar-mobile .autoimex_close').on('click', function(ev) {\n                $('body').removeClass('autoimex_open-Sidebar');\n            });\n            \n            $('.bg-mobile').on('click', function(ev) {\n                if ($('body').hasClass('autoimex_open-Sidebar')) {\n                    $('body').removeClass('autoimex_open-Sidebar');\n                }\n            });\n        }\n    }\n\n    carouselLeftSidebar() {\n        $('.sidebarBlock .productCarousel').slick({\n            infinite: true,\n            slidesToShow: 1,\n            slidesToScroll: 1,\n            dots: false,\n            arrows: true,\n            autoplay: true,\n            autoplaySpeed: 3000,\n            mobileFirst: true,\n            nextArrow: '<svg class=\"slick-next slick-arrow\"><use xlink:href=\"#slick-arrow-next1\"></use></svg>',\n            prevArrow: '<svg class=\"slick-prev slick-arrow\"><use xlink:href=\"#slick-arrow-prev1\"></use></svg>',\n            responsive: [\n                {\n                    breakpoint: 1025,\n                    settings: {\n                        slidesToShow: 1,\n                        slidesToScroll: 1,\n                        dots: true,\n                        arrows: true\n                    }\n                }\n            ]\n        });\n    }\n\n    product_sidebar() {\n        if ($('.all-categories-list').length > 0) {\n            $('.all-categories-list .icon-dropdown').on('click', function() {\n                var $this = $(this).parent();\n                $this.siblings().removeClass('is-clicked');\n                $this.toggleClass('is-clicked');\n                $this.siblings().find(\"> .dropdown-category-list\").slideUp( \"slow\" );\n                $this.find(\"> .dropdown-category-list\").slideToggle( \"slow\" );\n           });\n        }\n    }\n}\n"],"names":["Search","_CatalogPage","apply","arguments","_proto","prototype","formatCategoryTreeForJSTree","node","_this","nodeData","text","data","id","metadata","state","selected","opened","children","forEach","childNode","push","showProducts","url","urlUtils","replaceParams","window","location","href","section","this","$productListingContainer","removeClass","$contentResultsContainer","addClass","$","parent","goToUrl","showContent","onReady","_this2","compareProducts","context","urls","$searchForm","$categoryTreeContainer","find","Url","treeData","$facetedSearchContainer","length","initFacetedSearch","onSortBySubmit","bind","hooks","on","sidebar_mobile","product_sidebar","carouselLeftSidebar","product_id","val","Countdown","collapsibleFactory","event","preventDefault","query","validator","initValidation","bindValidation","categoryTree","categoryTreeData","createCategoryTree","selectedCategoryIds","jstree","get_selected","check","remove","_step","_iterator","_createForOfIteratorHelperLoose","done","categoryId","value","input","type","name","append","loadTreeNodes","cb","_this3","selectedCategoryId","prefix","formattedResults","dataNode","$container","_this4","treeOptions","core","themes","icons","checkbox","three_state","plugins","$searchHeading","$searchCount","requestOptions","template","productListing","sidebar","heading","productCount","config","product_results","limit","searchProductsPerPage","showMore","facetedSearch","FacetedSearch","content","html","animate","scrollTop","$form","nod","submit","$element","add","selector","validate","errorMessage","performCheck","areAll","clone","appendTo","document","ev","hasClass","slick","infinite","slidesToShow","slidesToScroll","dots","arrows","autoplay","autoplaySpeed","mobileFirst","nextArrow","prevArrow","responsive","breakpoint","settings","$this","siblings","toggleClass","slideUp","slideToggle","CatalogPage"],"sourceRoot":""}